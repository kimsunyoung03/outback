<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script src='https://unpkg.com/panzoom@9.4.0/dist/panzoom.min.js'></script>
<script src='./common.js'></script>
<link rel="stylesheet" href="./style.css" />
<title>아웃백</title>
</head>
<body>
<article id="outback_game_mobile">
    <div class="frame_wrap">
        <img class="logo" src="./img/logo.png">
        <div class="count_area">
            <p><span class="count">0</span>&nbsp;/&nbsp;5</p>
        </div>
        <div class="repeat">
            <img src="./img/repeat.png" alt="임시아이콘_재정렬">
        </div>
        <div class="bottom_item">
            <img id="item2" src="./img/item2.png" alt="퀸즈랜드 립아이 & 스콜피온 슈림프">
            <img id="item5" src="./img/item5.png" alt="스콜피온 베이비 백 립 with TABASCO Scorpion Sauce">
            <img id="item4" src="./img/item4.png" alt="패션후르츠 슈림프 샐러드">
            <img id="item1" src="./img/item1.png" alt="수박 그라나따">
            <img id="item3" src="./img/item3.png" alt="망고 그라나따">
        </div>
        <article id="start_modal">
            <div class="modal_wrap">
                <img src="./img/start.png" alt="숨은맵시를 찾아서" loading="lazy">
                <button type="button" class="start_button">START</button>
            </div>
        </article>
        <article id="cotrol" class="on" style="pointer-events:none;">
            <div class="cotrol_wrap">
            <img src="./img/cotrol.png">
            <p class="control_txt01">숨은 그림 찾기 진행 시 이미지가 보이지 않을 때,<br/>상단의 버튼을 선택하시면 화면에 다시 나타나요!</p>
            </div>
        </article>
    </div>

    <div class="game_wrap v-img-zoom" id="myPanzoom">
        <div class="v-img-zoom--wrapper"  >
            <div class="v-img-zoom--item">
                <div  class="f-panzoom__content">
                        <img src="./img/Background_m.webp"  usemap="#imgmap2024723202832" loading="lazy" oncontextmenu="return false">
                        <img src="./img/item1_check_m.png" class="pin_s" id="item1_check" loading="lazy" >
                        <img src="./img/item2_check_m.png" class="pin_s" id="item2_check" loading="lazy">
                        <img src="./img/item3_check_m.png" class="pin_s" id="item3_check" loading="lazy">
                        <img src="./img/item4_check_m.png" class="pin_s" id="item4_check" loading="lazy">
                        <img src="./img/item5_check_m.png" class="pin_s" id="item5_check" loading="lazy">
                </div>
                <!-- 원본사이즈
                    <map id="imgmap202471885638" name="imgmap202471885638">
                    <area id="area1" shape="rect" alt="수박 그라나따" title="" coords="448,1364,660,1576" />
                    <area id="area2" shape="rect" alt="퀸즈랜드 립아이 & 스콜피온 슈림프" title="" coords="2220,516,2460,756" />
                    <area id="area3" shape="rect" alt="망고 그라나따" title="" coords="3568,2416,3856,2704" />
                    <area id="area4" shape="rect" alt="패션후르츠 슈림프 샐러드" title="" coords="628,2732,860,2964"  />
                    <area id="area5" shape="rect" alt="스콜피온 베이비 백 립 with TABASCO Scorpion Sauce" title="" coords="300,5044,596,5340"/>
                </map> -->
                <!-- 720px
                    <map id="imgmap2024723181951" name="imgmap2024723181951">
                    <area id="area1" shape="rect" alt="수박 그라나따"  coords="71,235,130,309">
                    <area id="area2" shape="rect" alt="퀸즈랜드 립아이 & 스콜피온 슈림프" coords="382,82,446,149">
                    <area id="area3" shape="rect" alt="망고 그라나따" coords="634,424,694,495">
                    <area id="area4" shape="rect" alt="패션후르츠 슈림프 샐러드"  coords="89,476,169,549">
                    <area id="area5" shape="rect" alt="스콜피온 베이비 백 립 with TABASCO Scorpion Sauce" coords="54,903,123,970">
                </map> -->
                <!-- 1600px
                    <map id="imgmap2024723183915" name="imgmap2024723183915">
                    <area id="area1" shape="rect" alt="수박 그라나따" coords="171,541,279,696">
                    <area id="area2" shape="rect" alt="퀸즈랜드 립아이 & 스콜피온 슈림프"  coords="847,189,988,339">
                    <area id="area3" shape="rect" alt="망고 그라나따" coords="1438,968,1556,1102">
                    <area id="area4" shape="rect" alt="패션후르츠 슈림프 샐러드" coords="211,1069,369,1214">
                    <area id="area5" shape="rect" alt="스콜피온 베이비 백 립 with TABASCO Scorpion Sauce" coords="110,2023,261,2152">
                </map> -->
                <map id="imgmap2024723202832" name="imgmap2024723202832">
                    <area id="area1" shape="rect" alt="수박 그라나따" coords="216,667,352,876" >
                    <area id="area2" shape="rect" alt="퀸즈랜드 립아이 & 스콜피온 슈림프"  coords="1063,252,1227,433" >
                    <area id="area3" shape="rect" alt="망고 그라나따" coords="1792,1210,1946,1380">
                    <area id="area4" shape="rect" alt="패션후르츠 슈림프 샐러드" coords="244,1349,465,1544">
                    <area id="area5" shape="rect" alt="스콜피온 베이비 백 립 with TABASCO Scorpion Sauce" coords="99,2501,344,2715">
                </map>
            </div>
        </div>
        <div class="item_modal">
            <img id="item1_poup" src="./img/item1_popup.png" alt="수박 그라나따(팝업)">
            <img id="item2_poup" src="./img/item2_popup.png" alt="퀸즈랜드 립아이 & 스콜피온 슈림프(팝업)">
            <img id="item3_poup" src="./img/item3_popup.png" alt="망고 그라나따(팝업)">
            <img id="item4_poup" src="./img/item4_popup.png" alt="패션후르츠 슈림프 샐러드(팝업)">
            <img id="item5_poup" src="./img/item5_popup.png" alt="스콜피온 베이비 백 립 with TABASCO Scorpion Sauce(팝업)">
        </div>
    </div>
</article>


<script>
    $(document).ready(function() {
        $('#start_modal').addClass('on');
    });
    
    var element = document.querySelector('.v-img-zoom--item');
    var is_visible_cotrol = true;
    var pz_elm = panzoom(element, {
        maxZoom: 1,
        minZoom: 0.45,
        initialX: 0,
        initialY: 0,
        initialZoom: .45,
        smoothScroll: false,
        zoomDoubleClickSpeed: 1,
        onTouch: function (e) {
            e.preventDefault();
            e.stopPropagation();
            if (is_visible_cotrol) {
                $('#cotrol').removeClass('on');
                is_visible_cotrol = false;
            }
            return false;
        },
        onDoubleClick: function () {
            return false;
        }
    });

    function handlePanzoomResetPosition() {
        var pzElmTransform = pz_elm.getTransform()
        var myPzElm = document.querySelector('#myPanzoom');
        var myPzElmBoundingClientRect = myPzElm.getBoundingClientRect();
        var itemElm = document.querySelector('.v-img-zoom--item');
        var itemElmBoundingClientRect = itemElm.getBoundingClientRect();
        var x = Math.max(myPzElmBoundingClientRect.width - itemElmBoundingClientRect.width, Math.min(0, pzElmTransform.x));
        var y = Math.max(myPzElmBoundingClientRect.height - itemElmBoundingClientRect.height + 5, Math.min(0, pzElmTransform.y));
        pz_elm.smoothMoveTo(x, y);
    }

    setInterval(handlePanzoomResetPosition, 300);

    $('.repeat').on("click", function () {
        pz_elm.smoothZoom(0, 0, 0.15);
        setTimeout(function () {
            pz_elm.smoothMoveTo(-54.2044, -169.931);
        }, 500);
    })

    $('.start_button').click(function () {
        $('#start_modal').removeClass('on')
        $('.cotrol_wrap').css("opacity","1");
        $('.repeat').css("opacity","1");
    })

    $('.item_modal img').click(function () {
        $(this).removeClass('on');
        updateCount();
    });

    $("#area1").on("touchstart", function (e) {
        $('#item1_poup').addClass('on');
        $('#item1_check').addClass('on');
        $('#item1').addClass('off');
        updateCount();
    })

    $("#area2").on("touchstart", function (e) {
        $('#item2_poup').addClass('on');
        $('#item2_check').addClass('on');
        $('#item2').addClass('off');
        updateCount();
    })

    $("#area3").on("touchstart", function (e) {
        $('#item3_poup').addClass('on');
        $('#item3_check').addClass('on');
        $('#item3').addClass('off');
        updateCount();
    })

    $("#area4").on("touchstart", function (e) {
        $('#item4_poup').addClass('on');
        $('#item4_check').addClass('on');
        $('#item4').addClass('off');
        updateCount();
    })

    $("#area5").on("touchstart", function (e) {
        $('#item5_poup').addClass('on');
        $('#item5_check').addClass('on');
        $('#item5').addClass('off');
        updateCount();
    })

    function updateCount() {
    var onCount = $('.bottom_item img.off').length;
    $('.count').text(onCount);

    if (onCount === 5) {
            setTimeout(function() {
                location.href = './reward01.html';
            }, 2500);
        }
    }


    //모바일 롱클릭 방지
    window.oncontextmenu = function(event) {
    event.preventDefault();
    event.stopPropagation();
    return false;
    };

    // 페이지가 로드될 때 실행될 함수
    function checkAndReloadOnce() {
        // 쿠키 이름 설정
        const cookieName = 'firstVisit';

        // 쿠키가 없으면 새로고침하고 쿠키 설정
        if (!getCookie(cookieName)) {
            // 쿠키 설정: 1일 동안 유효
            document.cookie = `${cookieName}=true; max-age=${60*60*24};`;
            window.location.reload(); // 페이지 새로고침
        }
    }

    // 쿠키 가져오기 함수
    function getCookie(name) {
        const cookies = document.cookie.split(';');
        for (let cookie of cookies) {
            const [cookieName, cookieValue] = cookie.split('=');
            if (cookieName.trim() === name) {
                return cookieValue;
            }
        }
        return null;
    }

    // 페이지가 로드될 때 한 번 실행
    window.addEventListener('load', checkAndReloadOnce);
</script>

<script type="text/javascript">document.addEventListener("contextmenu",function(e){"IMG"===e.target.nodeName&&e.preventDefault()},!1);</script>

</body>
</html>
