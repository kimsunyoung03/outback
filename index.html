<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="viewport" content="initial-scale=1.0,user-scalable=no,maximum-scale=1,width=device-width">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script src='https://unpkg.com/panzoom@9.4.0/dist/panzoom.min.js'></script>
<script src='./common.js'></script>
<link rel="stylesheet" href="./style.css" />
<link rel="stylesheet" href="path/to/font-awesome/css/font-awesome.min.css">


<title>TEST</title>
</head>
<body>
<article id="outback_game_pc">

    <div class="frame_wrap">
        <img class="logo" src="./img/logo.png">
        <img class="frame" src="./img/frame_pc.png">
        <div class="count_area">
            <p><span class="count">0</span>&nbsp;/&nbsp;5</p>
        </div>
        <div class="repeat">
            <img src="./img/repeat.png" alt="임시아이콘_재정렬">
        </div>
        <div class="bottom_item">
            <img id="item2" src="./img/item2.png" alt="퀸즈랜드 립아이 & 스콜피온 슈림프">
            <img id="item5" src="./img/item5.png" alt="스콜피온 베이비 백 립 with TABASCO Scorpion Sauce">    
            <img id="item4" src="./img/item4.png" alt="패션후르츠 슈림프 샐러드">
            <img id="item1" src="./img/item1.png" alt="수박 그라나따">
            <img id="item3" src="./img/item3.png" alt="망고 그라나따">
        </div>
        <article id="start_modal" class="on">
            <div class="modal_wrap">
                <img src="./img/start_pc.png" alt="숨은맵시를 찾아서">
            </div>
        </article>
        <article id="cotrol" class="on">
            <img src="./img/cotrol_pc.png">
        </article> 


        <article id="reward">
            <div class="reward01">
                <iframe src="./reward01.html" width="360" height="600" frameborder='0' ></iframe>
            </div>
            <div class="reward02">
                <iframe src="./reward02.html" width="360" height="600" frameborder='0' ></iframe>
            <div class="reward03">
                <iframe src="./reward03.html" width="360" height="600" frameborder='0' ></iframe>
            </div>
            <div class="reward04">
                <iframe src="./reward04.html" width="360" height="600" frameborder='0' ></iframe>
            </div>
        </article>
    </div>

    <div class="game_wrap v-img-zoom" id="myPanzoom"> 
        <div class="v-img-zoom--wrapper"  >
            <div class="v-img-zoom--item">
                <div  class="f-panzoom__content">
                    <img src="./img/Background.png"  usemap="#imgmap202471885638">
                    <img src="./img/item1_check.png" class="pin_s" id="item1_check">
                    <img src="./img/item2_check.png" class="pin_s" id="item2_check">
                    <img src="./img/item3_check.png" class="pin_s" id="item3_check">
                    <img src="./img/item4_check.png" class="pin_s" id="item4_check">
                    <img src="./img/item5_check.png" class="pin_s" id="item5_check">
                </div>
                <map id="imgmap202471885638" name="imgmap202471885638">
                    <area id="area1" shape="rect" alt="수박 그라나따" title="" coords="448,1364,660,1576" />
                    <area id="area2" shape="rect" alt="퀸즈랜드 립아이 & 스콜피온 슈림프" title="" coords="2220,516,2460,756" />
                    <area id="area3" shape="rect" alt="망고 그라나따" title="" coords="3568,2416,3856,2704" />
                    <area id="area4" shape="rect" alt="패션후르츠 슈림프 샐러드" title="" coords="628,2732,860,2964"  />
                    <area id="area5" shape="rect" alt="스콜피온 베이비 백 립 with TABASCO Scorpion Sauce" title="" coords="300,5044,596,5340"/>
                </map>
            </div>
        </div>
        <div class="item_modal">
            <img id="item1_poup" src="./img/item1_popup.png" alt="수박 그라나따(팝업)">
            <img id="item2_poup" src="./img/item2_popup.png" alt="퀸즈랜드 립아이 & 스콜피온 슈림프(팝업)">
            <img id="item3_poup" src="./img/item3_popup.png" alt="망고 그라나따(팝업)">
            <img id="item4_poup" src="./img/item4_popup.png" alt="패션후르츠 슈림프 샐러드(팝업)">
            <img id="item5_poup" src="./img/item5_popup.png" alt="스콜피온 베이비 백 립 with TABASCO Scorpion Sauce(팝업)">
        </div>
    </div>
</article>


<script>
var trf_f_x = 0; // transform의 처음 x 값 전역변수
var trf_f_y = 0; // transform의 처음 y 값 전역변수
var trf_f_scale = 0; // transform의 처음 scale 값 전역변수
    
var element = document.querySelector('.v-img-zoom--item');
var pz_elm = panzoom(element, {
                        zoomSpeed: 0.200,
                        pinchSpeed: 2,
                        maxZoom:1,
                        minZoom:0.527106,
                        zoomDoubleClickSpeed: 0,
                        initialX: -103.353,
                        initialY: -3054.69,
                        initialZoom:0.527106,
                        padding:0.5
                    });


$(document).ready(function(){
    /* 모든 컨트롤이 그려진 이후 이벤트 발생 */
    window.onload = function() { // window.addEventListener('load', (event) => {와 동일합니다.
        /* 예전 방식으로 처음 x,y 값 가져오기 => 지워도 됨
        var getFirstStyle = element.style;
        // console.log(getFirstStyle);
        var getFirstTrf = getFirstStyle.transform; // 좌표값 텍스트를 가져온다.
        // console.log(getFirstTrf);
        var trfFirstRplace = getFirstTrf.replace(")", ""); // 좌표값의 필요없는 ) 를 제거
        var trfFirstSplit = trfFirstRplace.split(","); // ',' 를 기준으로 배열로 나눈다.
        end */

        /* 이미지가 그려지고 나서 처음의 x, y, scale의 값을 구한다. */
        trf_f_x = pz_elm.getTransform().x; // trfFirstSplit[4] 초기 x
        trf_f_y = pz_elm.getTransform().y; // trfFirstSplit[5] 초기 y
        trf_f_scale = pz_elm.getTransform().scale; // 초기 scale

        /*
        console.log("x 값 : ", trf_f_x);
        console.log("y 값 : ", trf_f_y);
        console.log("scale 값 : ", trf_f_scale);
        */
    };
    
/* panzoom 기능에서는 이미지 드래그 이벤트가 호출 안됨.
=> 마우스업, 터치이벤트로 전환
=> 향후 이미지가 panzoom 영역 밖으로 너무 이동될 때 마우스 포인터가 이미지 위가 아닌 panzoom 영역 위에 있으면 이벤트 발동이 안됨.
=> 위 경우에도 이벤트가 발동 되도록 해야함 */
$('.v-img-zoom--wrapper').on("mouseup touchend", function (e) {
    //console.log(element);
    var getStyle = element.style;
    //console.log(getStyle);
    var getTrf = getStyle.transform; // 좌표값 텍스트를 가져온다.
    //console.log(getTrf);
    var trfRplace = getTrf.replace(")", ""); // 좌표값의 필요없는 ) 를 제거
    var trfSplit = trfRplace.split(","); // ',' 를 기준으로 배열로 나눈다.
    //console.log(trfSplit); // 
    //console.log(trfSplit[4]);
    //console.log(trfSplit[5]);

    var trf_x = trfSplit[4]; // 현재 x 값
    var trf_y = trfSplit[5]; // 현재 y 값
    
    // console.log(pz_elm.getTransform());

    console.log("초기 x값 : ", trf_f_x);
    // console.log("초기 x값에 -1000 : ", trf_f_x-1000); // 디테일하게 -, + 설정하기 위한 log
    
    /* 1. boundsPadding 기능을 이용하여 이미지가 밖으로 나가지 못하게 한다.(좌,우,위로 올리기는 잘 됨 / 이미지 아래로 내리기는 밖으로 나가짐)
        => v-img-zoom--wrapper 영역의 크기 때문에 아래로 내리기가 안먹히는건지 아닌지 알아봐야함
     * 2. 이미지가 너무 가장자리로 이동할 경우 이미지 위치를 초기화 해야한다. (0,0)
     * 3. 범위를 세밀하게 조정 해야한다. (x-400, y+400 등...)
     * 4. 휠 이벤트 발생으로 인해 스케일 변경에 따른 범위 계산을 해야한다? => 스케일 변경 상관없이 x,y(0,0)으로 초기화
     */
    if(trf_x < trf_f_x-1500) { // 처음 x의 값보다 -500
        // css에 x,y를 직접 지정한다. => 다만 이렇게 해도 이미지 위치 변경시 버그가 발생한다. => 지워도 됨
        // $('.v-img-zoom--item').css("transform", "matrix(0.527106, 0, 0, 0.527106," + trf_f_x + "," + trf_f_y + ")");

        // panzoom 자체에 x,y값을 지정한다. => 0,0 스케일 1으로 초기화 될뿐 정해준 수치대로 이동 안됨. => 지워도 됨
        // pz_elm = panzoom(element, {
        //           initialX: -48,
        //           initialY: -1444,
        //           // transformOrigin: {x: -48, y: -1444}
        //         });

        /* 부드럽게 이동 : instance.smoothMoveTo(0, 0);
           부드럽게 줌 변경 및 이동 : instance.smoothZoom(0, 0, 0.5) */
           pz_elm.smoothZoom(0,0, 0.527106);
            setTimeout(function() {
                pz_elm.smoothMoveTo(-48.875, -1444.54);
            }, 800);
        

    } else if(trf_x > trf_f_x+1500) { // 처음 x의 값보다 +500
        pz_elm.smoothZoom(0,0, 0.527106);
        setTimeout(function() {
            pz_elm.smoothMoveTo(-48.875, -1444.54);
        }, 1800);
    } else if(trf_y < trf_f_y-840) { // 처음 y의 값보다 -400
        pz_elm.smoothZoom(0,0, 0.527106);
            setTimeout(function() {
                pz_elm.smoothMoveTo(-48.875, -1444.54);
            }, 800);
    } else if(trf_y > trf_f_y+100) { // 처음 y의 값보다 +400
        pz_elm.smoothZoom(0,0, 0.527106);
        setTimeout(function() {
            pz_elm.smoothMoveTo(-48.875, -1444.54);
        }, 800);
    }
});

$('.repeat').on("click", function() {
    pz_elm.smoothZoom(0,0, 0.527106);
    setTimeout(function() {
        pz_elm.smoothMoveTo(-48.875, -1444.54);
    }, 500);
})

$('#cotrol').on("click touchstart", function (e) {
    $(this).removeClass('on');
})

$('#start_modal').click(function(){
    $('#start_modal').removeClass('on')
})

$('.item_modal img').click(function(){
    $(this).removeClass('on');
    updateCount();
});
$("#area1").on("click touchstart", function (e) {
    $('#item1_poup').addClass('on');
    $('#item1_check').addClass('on');
    $('#item1').addClass('off');
    updateCount();
})
$("#area2").on("click touchstart", function (e) {
    $('#item2_poup').addClass('on');
    $('#item2_check').addClass('on');
    $('#item2').addClass('off');
    updateCount();
})
$("#area3").on("click touchstart", function (e) {
    $('#item3_poup').addClass('on');
    $('#item3_check').addClass('on');
    $('#item3').addClass('off');
    updateCount();
})
$("#area4").on("click touchstart", function (e) {
    $('#item4_poup').addClass('on');
    $('#item4_check').addClass('on');
    $('#item4').addClass('off');
    updateCount();
})
$("#area5").on("click touchstart", function (e) {
    $('#item5_poup').addClass('on');
    $('#item5_check').addClass('on');
    $('#item5').addClass('off');
    updateCount();
})

function updateCount() {
    var onCount = $('.item_modal img.on').length;
    $('.count').text(onCount);
    
    if (onCount === 5) {
        setTimeout(function() {
            $('#reward').addClass('on');
            $('.reward01').addClass('on');
        }, 2500); 
    }
}

$('.retry').on("click touchstart", function (e) {
    location.reload();
})

});
</script>
</body>
</html>
